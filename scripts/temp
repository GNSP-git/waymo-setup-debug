def collect_trajectories(file_path):
    trajs = {}
    t0 = None

    ds = tf.data.TFRecordDataset(file_path, compression_type="")
    for raw in ds:
        frame = open_dataset.Frame()
        frame.ParseFromString(raw.numpy())
        t = frame.timestamp_micros * 1e-6
        if t0 is None:
            t0 = t

        # --- Detect which labels are present ---
        labels = []

        if len(frame.laser_labels) > 0:
            # primary 3D bounding boxes
            for lab in frame.laser_labels:
                labels.append(lab)

        else:
            # fallback: CAMERA labels
            for cam in frame.camera_labels:
                for lab in cam.labels:
                    labels.append(lab)

        # --- Extract OBBs ---
        for lab in labels:
            name = label_type_name(lab.type)
            box = lab.box
            L, W, H = ensure_dims(name, box.length, box.width, box.height)
            rec = {
                "t": t,
                "cx": box.center_x,
                "cy": box.center_y,
                "heading": box.heading,
                "length": L,
                "width": W,
                "height": H,
                "type": name,
                "id": lab.id,
            }
            trajs.setdefault(lab.id, []).append(rec)

    for oid in trajs:
        trajs[oid].sort(key=lambda r: r["t"])
    return trajs, t0 or 0.0
